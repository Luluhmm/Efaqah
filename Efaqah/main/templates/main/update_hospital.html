{% extends 'doctor/base.html' %}
{% block title %} Update {{ role|title }} {% endblock %}

{% block content %}
<div class="bg-white rounded-lg border shadow-sm w-full max-w-4xl mx-auto p-6 mt-8">
    <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4 md:gap-0">
        <h2 class="text-2xl text-blue-800">Update {{ hospital.name }}</h2>

        <!-- Back Button -->
        <a href="{% url 'main:all_hospital_view' %}"
           class="inline-flex items-center justify-center rounded-lg h-10 px-4 text-sm font-medium bg-gray-100 text-gray-700 hover:bg-gray-200">
            ‚Üê Back
        </a>
    </div>

    <!-- Flash Messages -->
    {% if messages %}
        <div class="space-y-2 my-4">
            {% for message in messages %}
                <div class="{% if message.tags == 'success' %}bg-green-100 text-green-700 border border-green-300{% elif message.tags == 'error' %}bg-red-100 text-red-700 border border-red-300{% else %}bg-gray-100 text-gray-700 border border-gray-300{% endif %} px-4 py-2 rounded-md">
                    {{ message }}
                </div>
            {% endfor %}
        </div>
    {% endif %}

    <form method="post" 
          action="{% url 'main:update_hospital' hospital.id %}" 
          class="space-y-6">
        {% csrf_token %}

        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
    <!-- Name -->
    <div class="space-y-2">
        <label for="name" class="text-sm font-medium">Name *</label>
        <input type="text" id="name" name="name" value="{{ hospital.name }}" required
               class="flex h-10 w-full rounded-md border border-input px-3 py-2 text-sm">
    </div>

    <!-- Country -->
   <!-- Country -->
<div class="space-y-2">
    <label for="country" class="text-sm font-medium">Country *</label>
    <select id="country" name="country" required
            class="flex h-10 w-full rounded-md border border-input px-3 py-2 text-sm">
        <option value="">Select a country</option>
        {% for country in countries %}
            <option value="{{ country.id }}"
                {% if hospital.country and hospital.country.id == country.id %}selected{% endif %}>
                {{ country.name }}
            </option>
        {% endfor %}
    </select>
</div>

<!-- City -->
<div class="space-y-2">
    <label for="city" class="text-sm font-medium">City</label>
    <select id="city" name="city" class="flex h-10 w-full rounded-md border border-input px-3 py-2 text-sm">
        <option value="">Select a city</option>
        {% for city in cities %}
            <option value="{{ city.id }}"
                {% if hospital.city and hospital.city.id == city.id %}selected{% endif %}>
                {{ city.name }}
            </option>
        {% endfor %}
    </select>
</div>

    <!-- Address -->
    <div class="space-y-2">
        <label for="address" class="text-sm font-medium">Address</label>
        <input type="text" name="address" id="address" value="{{ hospital.address }}"
               class="flex h-10 w-full rounded-md border border-input px-3 py-2 text-sm">
    </div>

    <!-- Email -->
    <div class="space-y-2">
        <label for="contact_email" class="text-sm font-medium">Email *</label>
        <input type="email" id="contact_email" name="contact_email" value="{{ hospital.contact_email }}" required
               class="flex h-10 w-full rounded-md border border-input px-3 py-2 text-sm">
    </div>

    <!-- Phone -->
    <div class="space-y-2">
        <label for="contact_phone" class="text-sm font-medium">Phone *</label>
        <input type="text" id="contact_phone" name="contact_phone" value="{{ hospital.contact_phone }}" required
               class="flex h-10 w-full rounded-md border border-input px-3 py-2 text-sm">
    </div>
</div>


        <!-- Submit Button -->
        <div class="flex justify-end mt-4">
            <button type="submit" class="px-4 py-2 bg-blue-100 text-blue-700 hover:bg-blue-200 rounded-md">
                Update Hospital
            </button>
        </div>
    </form>
</div>
<script>
document.getElementById("country").addEventListener("change", function() {
    const countryId = this.value;
    const citySelect = document.getElementById("city");

    if (!countryId) {
        citySelect.innerHTML = '<option value="">Select a city</option>';
        return;
    }

    fetch(`/get-cities/${countryId}/`)
        .then(response => response.json())
        .then(data => {
            citySelect.innerHTML = '<option value="">Select a city</option>';
            data.cities.forEach(city => {
                const opt = document.createElement("option");
                opt.value = city.id;
                opt.textContent = city.name;
                citySelect.appendChild(opt);
            });
        })
        .catch(err => {
            console.error("Error loading cities:", err);
        });
});
</script>
{% endblock %}